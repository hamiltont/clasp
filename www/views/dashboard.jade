extends layout

//- Add tab-specific scoping
append scriptOnReady
  | clasp.dash = {};
  | clasp.dash.summary = {};

//- Enables fully-hidden table rows
style(type='text/css')
  | .accordianRow {
  |     padding: 0 !important;
  | }

block content
  // Full width panel is the main container for the dashboard
  div.container-fluid: div.panel.panel-default
    div.panel-heading: h3.panel-title Clasp Dashboard   
      span.small.pull-right#runxacrossy: // Will be filled in by t-runxacrossy
    div.panel-body
      // Embedded tabbed interface
      ul.nav.nav-tabs(role="tablist")
        li.active: a(href="#summary",role="tab",data-toggle="tab") Summary
        li: a(href="#nodes",role="tab",data-toggle="tab") Nodes
        li: a(href="#emulators",role="tab",data-toggle="tab") Emulators
        li.dropdown
          a.dropdown-toggle(data-toggle="dropdown") System
            span.caret
          ul.dropdown-menu(role="menu")
            li: a(href="#metrics",role="tab",data-toggle="tab") Metrics
            li: a(href="#settings",role="tab",data-toggle="tab") Settings
            li: a(href="#refresh",role="tab",data-toggle="tab") Force Refresh
            li: a(href="#shutdownModal",data-toggle="modal",data-keyboard="true") Shutdown
        // Open Device Control Panels
        li: a.btn.btn-primary(href="#phone1",role="tab",data-toggle="tab")
          span.glyphicon.glyphicon-phone 
        li: a.btn.btn-primary(href="#phone2",role="tab",data-toggle="tab")
          span.glyphicon.glyphicon-phone 
        li: a.btn.btn-primary(href="#phone3",role="tab",data-toggle="tab")
          span.glyphicon.glyphicon-phone 
        // Open Node Control Panels
        li: a.btn.btn-info(href="#node1",role="tab",data-toggle="tab")
          span.glyphicon.glyphicon-cloud
        li: a.btn.btn-info(href="#node2",role="tab",data-toggle="tab")
          span.glyphicon.glyphicon-cloud 

      // Tab Panes
      div.tab-content
        div.tab-pane.active#summary
          // Emulator Summary Next
          //- Panel helps to visually separate node summary and emulator summary
          div.panel.panel-default
            div.panel-heading: h3.panel-title Recently Updated Devices  
              span.small Click any row to get more information
            
            table.table.table-condensed.table-hover#devicesummary 
              //- Node rows will come from t-summarydevicerow
              tr
                th.col-md-1 VNC
                th.col-md-2 Worker Node
                th.col-md-2 Update
                th.col-md-2 Update Time
                th.col-md-5 UUID

          // Node Summary
          //- Panel helps to visually separate node summary and emulator summary
          div.panel.panel-default
            div.panel-heading: h3.panel-title Recently Updated Workers   
              span.small Click any row to get more information
            table.table.table-condensed.table-hover#nodesummary
              //- Node rows will come from t-summarynoderow
              tr
                th.col-md-1 
                th.col-md-2 IP
                th.col-md-2 Status
                th.col-md-2 Last Update
                th.col-md-5 UUID
        div.tab-pane#nodes: p Node stuff
        div.tab-pane#emulators: p device stuff
        div.tab-pane#settings: p settings stuff
        div.tab-pane#metrics: p metrics stuff


append modals
  div#shutdownModal.modal.fade(tabindex='-1')
    div.modal-dialog: div.modal-content
      div.modal-header
        button.close(type="button",data-dismiss="modal") &times
        h4.modal-title Are You Sure?
      div.modal-body
        p.text-danger This will shut down all devices, all worker nodes, and this website
      div.modal-footer
        button.btn.btn-success(data-dismiss="modal") Get Me Out of Here!
        button.btn.btn-danger(data-dismiss="modal",onclick="shutdown()") Shutdown


//- -------------------------------------------------------
//- 
//-      Template definitions 
//- 
//- -------------------------------------------------------

//- Top right - Running 5 devices across 10 nodes
append templates
  script(id='t-runxacrossy',type='text/x-handlebars-template')
    | Running {{ emulators }} devices across {{ nodes }} nodes
append compileTemplates
  | templates.runxacrossy = Handlebars.compile($('#t-runxacrossy').html());
append scriptOnReady
  | setInterval(function() {
  |   var target = $('#runxacrossy');
  |   var context = {emulators: Math.floor((Math.random() * 20) + 1), nodes: "12"};
  |   var html = templates.runxacrossy(context);
  |   target.html(html);
  | }, 2000);


//- Summary node row
append templates
  script(id='t-summarynoderow',type='text/x-handlebars-template')
    tr.accordion-toggle(data-toggle="collapse",data-target="#ndetails-{{ uuid }}")
      td: button.btn.btn-xs.btn-info: span.glyphicon.glyphicon-cloud
      td {{ ip }}
      td(class="{{ update }}") {{ update }}
      td {{ updateTime }}
      td {{ uuid }}
    tr
      td.accordianRow(colspan="5")
        div.accordion-body.collapse(id="ndetails-{{ uuid }}") Details for Node {{ uuid }}
append compileTemplates
  | templates.summarynoderow = Handlebars.compile($('#t-summarynoderow').html());
append scriptOnReady
  | clasp.dash.summary.add_node = function(context) {
  |   var target = $('#nodesummary tr:last');
  |   var html = templates.summarynoderow(context);
  |   target.after(html);
  | };
  | 
  | var nsummary1 = {ip: "10.0.0.2", update: "Booting", 
  |                  updateTime: "10 seconds ago", uuid: "eec0d2cd-ef51-430f-bfc6-fec7e61e8bf6"};
  | var nsummary2 = {ip: "10.0.20.3", update: "Failed", 
  |                  updateTime: "1 minute ago", uuid: "77a3bc41-0d02-40a4-b68d-339d6b9a0124"};
  | var nsummary3 = {ip: "127.0.0.1", update: "Online", 
  |                  updateTime: "3 seconds ago", uuid: "62577119-8421-405f-9741-3f8e795ecc83"};
  | var nsummary4 = {ip: "10.0.20.7", update: "Offline", 
  |                  updateTime: "23 seconds ago", uuid: "7e0c0daf-b4c9-4330-9335-71ed38311155"};
  | clasp.dash.summary.add_node(nsummary1);
  | clasp.dash.summary.add_node(nsummary2);
  | clasp.dash.summary.add_node(nsummary3);
  | clasp.dash.summary.add_node(nsummary4);
  
  
  
//- Summary device row
append templates
  script(id='t-summarydevicerow',type='text/x-handlebars-template')
    tr.accordion-toggle(data-toggle="collapse",data-target="#dev-details-{{ uuid }}")
      td: button.btn.btn-xs.btn-primary: span.glyphicon.glyphicon-phone
      td {{ ip }}
      td {{ update }}
      td {{ updateTime }}
      td {{ uuid }}
    tr
      td.accordianRow(colspan="5")
        div.accordion-body.collapse(id="dev-details-{{ uuid }}") Details for Device {{ uuid }}
append compileTemplates
  | templates.summarydevicerow = Handlebars.compile($('#t-summarydevicerow').html());
append scriptOnReady
  | clasp.dash.summary.add_device = function(context) {
  |   var target = $('#devicesummary tr:last');
  |   var html = templates.summarydevicerow(context);
  |   target.after(html);
  | };
  | var dsummary1 = {ip: "10.0.0.2", update: "Crashed", 
  |                  updateTime: "10 seconds ago", uuid: "39513296-ef79-4311-8e92-3e6fcf13597c"};
  | var dsummary2 = {ip: "10.0.20.3", update: "Task Failed", 
  |                  updateTime: "1 minute ago", uuid: "591aeb1c-fd43-439e-aafa-0756d0cfb593"};
  | var dsummary3 = {ip: "127.0.0.1", update: "Task Success", 
  |                  updateTime: "22 seconds ago", uuid: "51459573-c743-4a82-a9a3-86eec3e9783e"};
  | var dsummary4 = {ip: "10.0.20.7", update: "Waiting For Task", 
  |                  updateTime: "23 seconds ago", uuid: "82ae6ee8-196e-4b50-af8b-92cb3355a1e2"};
  | clasp.dash.summary.add_device(dsummary1);
  | clasp.dash.summary.add_device(dsummary2);
  | clasp.dash.summary.add_device(dsummary3);
  | clasp.dash.summary.add_device(dsummary4);

//- Used in header.jade to mark current page active
block activePageBlock
  -var activePage = 'dashboard'

