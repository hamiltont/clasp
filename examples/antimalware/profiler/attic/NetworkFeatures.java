package io.magnum.antimalware.features;

import java.util.ArrayList;
import android.net.TrafficStats;

/**
 * Gets networking features via the TrafficStats class.
 */
public class NetworkFeatures extends AbstractFeatures {
  private ArrayList<Attribute> _attributes;

  public NetworkFeatures() {
    _tags = new String[] { "networkTotalTXPackets", "networkTotalTXBytes", 
          "networkTotalRXPackets", "networkTotalRXBytes" };
  }

  public void fetchData() {
    // -1 (TrafficStats.UNSUPPORTED) is returned if the operation isn't supported
    long totalTXPackets = TrafficStats.getTotalTxPackets();
    long totalTXBytes = TrafficStats.getTotalTxBytes();
    long totalRXPackets = TrafficStats.getTotalRxPackets();
    long totalRXBytes = TrafficStats.getTotalRxBytes();

    _totalTXPacketsDiff = totalTXPackets - _totalTXPackets;
    _totalTXBytesDiff = totalTXBytes - _totalTXBytes;
    _totalRXPacketsDiff = totalRXPackets - _totalRXPackets;
    _totalRXBytesDiff = totalRXBytes - _totalRXBytes;

    _totalTXPackets = totalTXPackets;
    _totalTXBytes = totalTXBytes;
    _totalRXPackets = totalRXPackets;
    _totalRXBytes = totalRXBytes;
  }

  public Instance getInstance() {
    fetchData();

    _wh.resetAttributes(_attributes);

    _instance = new DenseInstance(_attributes.size());
    _instance.setValue(_attributes.get(0), _totalTXPackets);
    _instance.setValue(_attributes.get(1), _totalTXBytes);
    _instance.setValue(_attributes.get(2), _totalRXPackets);
    _instance.setValue(_attributes.get(3), _totalRXBytes);
    _instance.setValue(_attributes.get(4), _totalTXPacketsDiff);
    _instance.setValue(_attributes.get(5), _totalTXBytesDiff);
    _instance.setValue(_attributes.get(6), _totalRXPacketsDiff);
    _instance.setValue(_attributes.get(7), _totalRXBytesDiff);

    return _instance;
  }

  public ArrayList<Attribute> getAttributes() {
    return _attributes;
  }
}
