package io.magnum.antimalware.features;

import java.util.ArrayList;
import android.util.Log;

public class MemoryFeatures extends AbstractFeatures {
  private static String TAG = "AntimalwareMemory";

  public MemoryFeatures() {
    _tags = new String[] { "memActive", "memInactive", "memMapped",
      "memFreePages", "memAnonPages", "memFilePages", "memDirtyPages",
      "memWritebackPages" };
  }

  public FeatureValue[] getFeatureVector() {
    FileParser fp = new FileParser();
    if (!fp.load("/proc/meminfo")) {
      Log.w(TAG, "Unable to open /proc/meminfo.");
      return null;
    }

    int active = fp.readInt( 5, 1 );
    int inactive = fp.readInt( 6, 1 );
    int mapped = fp.readInt( 18, 1 );

    fp.close();

    if (!fp.load( "/proc/vmstat" )) {
      Log.w(TAG, "Unable to open /proc/vmstat.");
      return null;
    }

    int freePages = fp.readInt( 0, 1 );
    int anonPages = fp.readInt( 7, 1 );
    int filePages = fp.readInt( 9, 1 );
    int dirtyPages = fp.readInt( 10, 1 );
    int writebackPages = fp.readInt( 11, 1 );

    fp.close();

    return new FeatureValue[] { new FeatureValue(active),
      new FeatureValue(inactive), new FeatureValue(mapped),
      new FeatureValue(freePages), new FeatureValue(anonPages),
      new FeatureValue(filePages), new FeatureValue(dirtyPages),
      new FeatureValue(writebackPages) };
  }
}
